<html>
    <head>
        <meta charset="utf-8">
        <link rel="icon" href="favicon.png" type="image/png">

        <title>ADIP</title>

        <link rel="stylesheet" href="css/style.css">

        <script src="js/InpaintJS.js"></script>
        <script src="js/taskBoard.js"></script>
    </head>
    <body>
        <div style="height:100%;width:100%;display:flex;flex-direction: column;align-items: center;">
            <span id="opencv-info">openCV.js 還沒準備好</span>
            <div id="image-editor-canvas-div" style="position: relative; max-height: 90%;max-width:90%;">
                <canvas id="image-editor-canvas" style="max-height: 100%;max-width:100%;"></canvas>
                <canvas id="image-editor-mask-canvas" style="position: absolute;top: 0;left: 0;max-height: 100%;max-width:100%;"></canvas>
            </div>
            <div>
                <span onclick="
                        if(image_editor_mask_canvas.style.display!='none'){
                            image_editor_mask_canvas.style.display='none';
                            this.innerHTML='顯示遮罩';
                        }else{
                            image_editor_mask_canvas.style.display='block';
                            this.innerHTML='隱藏遮罩';
                        }
                    " style="text-decoration: underline;cursor: pointer;">隱藏遮罩</span>
            </div>
            <div>
                <div id="GrabCut-menu" style="display:none;">
                    <button onclick="
                            image_editing_data.grabCutFirst=false;
                            const ctx=image_editor_mask_canvas.getContext('2d');
                            ctx.clearRect(0, 0, image_editor_mask_canvas.width, image_editor_mask_canvas.height);
                            opencv_info.innerHTML='選擇一個區塊來計算物件';
                        ">重製遮罩</button>
                    <button onclick="
                            image_editing_data.grabCutFirst=true;
                            image_editing_data.grabCutAdd=1;
                            opencv_info.innerHTML='標記想要添加的部分';
                        ">添加區域</button>
                    <button onclick="
                            image_editing_data.grabCutAdd=2;
                            opencv_info.innerHTML='標記想要移除的部分';
                        ">去除區域</button>
                    <button onclick="saveGrabCut();">儲存影像</button>
                </div>
                <div id="Merge-menu" style="display:none;">
                    <select id="merge-layer-select"></select>
                    <button onclick="
                            if(image_editing_data.layer){
                                if(image_editing_data.select<image_editing_data.layer.length-1){
                                    moveItemInArray(image_editing_data.layer, image_editing_data.select, image_editing_data.select+1);
                                    moveItemInArray(image_editing_data.adjust, image_editing_data.select, image_editing_data.select+1);
                                    updateMergeLayerSelect();
                                    drawMergeImage();
                                }
                            }
                        ">&uarr;</button>
                    <button onclick="
                            if(image_editing_data.layer){
                                if(image_editing_data.select>0) {
                                    moveItemInArray(image_editing_data.layer, image_editing_data.select, image_editing_data.select-1);
                                    moveItemInArray(image_editing_data.adjust, image_editing_data.select, image_editing_data.select-1);
                                    updateMergeLayerSelect();
                                    drawMergeImage();
                                }
                            }
                        ">&darr;</button>
                    <button onclick="
                            if(image_editing_data.layer){
                                if(confirm('更換基底將重製畫面，確認更換?')) changeMergeBase(image_editing_data.select);
                            }
                        ">設為基底</button>
                    <button onclick="
                            if(image_editing_data.layer){
                                if(confirm(`確認刪除: ${image_editing_data.layer[image_editing_data.select].name}?`)){
                                    removeMergeLayer(image_editing_data.select);
                                }
                            }
                        ">刪除層</button><br>
                    <button onclick="saveMergeImage();">儲存影像</button>
                </div>
                <div id="PhotoFix-menu" style="display:none;">
                    <button onclick="fixImage();">修補影像</button>
                    <button onclick="saveFixImage();">儲存影像</button>
                </div>
            </div>
            <div style="margin-bottom: 25px;">
                <button onclick="setEditImage(null, 'NOPE');">清除圖像</button>
            </div>
            
            <div>
                <input id="image-input" type="file" accept="image/*" multiple disabled>
                <button id="image-example-btn" onclick="loadExample();" disabled>Load Example</button>
            </div>
            <div id="preview-image" style="width:100%;display:flex;flex-wrap: wrap;justify-content: center;align-content: flex-start;background:#f0f0f0;">
            </div>
        </div>

        <div style="position: absolute;top: 0;right: 0;max-height:50%;max-width:50%;">
            <div id="task-board-button" style="position: absolute;top: 0;right: 0;height:30px;width: 50px; background: #f0a0a0;border: 2px solid black;display: flex;justify-content: center;align-items: center;cursor: pointer;">TASK</div>
            <div id="task-board" style="display:none;max-height:100%;max-width:100%;min-height:100px;min-width:200px;background: #f0f0f0;border: 2px solid black;overflow-x:inherit;overflow-y: scroll;padding: 35px 5px 5px 5px;"></div>
        </div>

        <script src="js/image_editor.js"></script>
        <script src="js/main.js"></script>
        <script async src="js/opencv.js" onload="openCVReady();"></script>
    </body>
</html>